# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: commons.yml

service:
  auth: false
  base-path: /users
  endpoints:
    login-anonymously:
      path: /login-anonymously
      method: POST
      docs: Create an anonymous user session
      display-name: Login Anonymously
      response: Session
      errors:
        - commons.BadRequestError
    login-with-email:
      path: /login-with-email
      method: POST
      docs: Log a user in with their email.
      display-name: Login with Email
      request:
        name: LoginWithEmailRequest
        body:
          properties:
            email:
              type: string
      response: LoginWithEmailResponse
      errors:
        - commons.BadRequestError
    verify-login:
      path: /verify-login
      method: POST
      docs: Verify a user's login code.
      display-name: Verify Login
      request:
        name: VerifyLoginRequest
        body:
          properties:
            user_id:
              type: string
            verification_code:
              type: string
      response: Session
      errors:
        - commons.BadRequestError
    refresh-token:
      path: /refresh-token
      method: POST
      docs: Refresh an access token
      display-name: Refresh Token
      request:
        name: RefreshTokenRequest
        body:
          properties:
            session_id:
              type: string
            refresh_token:
              type: string
      response: Session
      errors:
        - commons.BadRequestError

types:
  Session:
    properties:
      id:
        type: string
      created_at:
        type: datetime
      project_id:
        type: string
      user_id:
        type: string
      access_token:
        type: string
      access_token_expires_at:
        type: datetime
      refresh_token:
        type: string
      refresh_token_expires_at:
        type: datetime
  LoginAnonymouslyResponse:
    properties:
      user_id:
        type: string
  LoginWithEmailResponse:
    properties:
      user_id:
        type: string
